-- Tạo ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui

-- Tạo Frame
local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 100, 0, 50) -- Giảm 50%
Frame.Position = UDim2.new(0.5, -50, 0.5, -25)
Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Frame.BorderSizePixel = 2
Frame.Draggable = true
Frame.Active = true
Frame.Parent = ScreenGui

-- Tạo Toggle Button
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 90, 0, 25) -- Giảm 50%
ToggleButton.Position = UDim2.new(0, 5, 0, 12)
ToggleButton.Text = "Loading..."
ToggleButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
ToggleButton.Parent = Frame

-- Đọc trạng thái từ file
local filename = "autodungeon_toggle.txt"
local enabled = false
if pcall(function() readfile(filename) end) then
    enabled = readfile(filename) == "true"
end

-- Hàm lưu trạng thái
local function saveState(state)
    writefile(filename, tostring(state))
end

-- Cập nhật trạng thái ban đầu
ToggleButton.Text = enabled and "Auto Dungeon: ON" or "Auto Dungeon: OFF"

-- Hàm bật/tắt tính năng
ToggleButton.MouseButton1Click:Connect(function()
    enabled = not enabled
    saveState(enabled)
    ToggleButton.Text = enabled and "Auto Dungeon: ON" or "Auto Dungeon: OFF"
    
    -- Thêm delay nhỏ để đảm bảo trạng thái đã được lưu lại trước khi tiếp tục
    wait(1)

    -- Chạy lại script nếu tính năng bật
    if enabled then
        -- Chạy script tự động khi tính năng bật
        loadstring(game:HttpGet('https://raw.githubusercontent.com/Baylac2006/avatar-fighting/refs/heads/main/autodungeon'))()
    end
end)

-- Chạy ngay script nếu trạng thái là "ON" khi khởi động
if enabled then
    wait(1)  -- Thêm chút thời gian chờ để đảm bảo mọi thứ đã sẵn sàng
    loadstring(game:HttpGet('https://raw.githubusercontent.com/Baylac2006/avatar-fighting/refs/heads/main/autodungeon'))()
end
