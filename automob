local TweenService = game:GetService("TweenService")
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")
local enemies = workspace.__Main.__Enemies.Server
local speed, tween = 300, nil

-- 🛠 Tìm quái gần nhất còn sống
local function findNearestMob()
    local nearest, minDist = nil, math.huge
    for _, mob in pairs(enemies:GetChildren()) do
        local hp = mob:GetAttribute("HP")
        if hp and hp > 0 then
            local dist = (mob.Position - rootPart.Position).Magnitude
            if dist < minDist then
                minDist, nearest = dist, mob
            end
        end
    end
    return nearest
end

-- 🚀 Tween tới quái
local function moveToMob(mob)
    if tween then tween:Cancel() end
    local info = TweenInfo.new((mob.Position - rootPart.Position).Magnitude / speed, Enum.EasingStyle.Linear)
    tween = TweenService:Create(rootPart, info, {CFrame = mob.CFrame})
    tween:Play()

    -- Kiểm tra quái còn sống khi đang Tween
    while task.wait(0.2) do
        if not mob.Parent or mob:GetAttribute("HP") <= 0 then
            tween:Cancel()
            return
        end
    end
end

-- 🔁 Auto bay liên tục
while true do
    local target = findNearestMob()
    if target then moveToMob(target) else wait(1) end
end
